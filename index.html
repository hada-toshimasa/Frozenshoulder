<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>五十肩マニュアル 完全攻略マスター（上級編）</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f4f7f6; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: relative; }
    h1 { text-align: center; color: #0056b3; margin-bottom: 25px; font-size: 1.8em; border-bottom: 2px solid #eee; padding-bottom: 15px; }
    .reset-btn { position: absolute; top: 20px; right: 20px; background: #95a5a6; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85em; transition: 0.3s; }
    .reset-btn:hover { background: #7f8c8d; }
    .status-bar { background: #e3f2fd; padding: 12px 20px; border-radius: 8px; display: flex; justify-content: space-between; color: #0056b3; font-weight: bold; margin-bottom: 25px; }
    .question-box { background: #f0f8ff; border-left: 6px solid #0056b3; padding: 20px; margin-bottom: 25px; font-size: 1.15em; font-weight: bold; line-height: 1.5; }
    .option-btn { display: block; width: 100%; padding: 15px; margin-bottom: 12px; background: #fff; border: 2px solid #d6eaf8; border-radius: 8px; text-align: left; cursor: pointer; transition: all 0.2s; font-size: 1em; color: #444; }
    .option-btn:hover { background-color: #e3f2fd; border-color: #0056b3; }
    .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
    .option-btn.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
    .feedback { display: none; margin-top: 20px; padding: 20px; border-radius: 8px; background: #f1f8e9; border: 1px solid #c8e6c9; color: #2e7d32; animation: fadeIn 0.3s; }
    .feedback.error { background: #fdecea; border: 1px solid #fadbd8; color: #7b241c; }
    .source-ref { display: block; margin-top: 8px; font-size: 0.85em; color: #666; text-align: right; font-style: italic; }
    .next-btn { display: block; width: 100%; padding: 18px; background: #0056b3; color: #fff; border: none; border-radius: 8px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 25px; opacity: 0.6; pointer-events: none; transition: 0.3s; }
    .next-btn.active { opacity: 1; pointer-events: auto; }
    .next-btn:hover { background-color: #004080; }
    #result-screen { display: none; text-align: center; padding: 20px; }
    .score-circle { width: 150px; height: 150px; background: #0056b3; color: #fff; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 30px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .score-num { font-size: 3.5em; font-weight: bold; line-height: 1; }
    .score-label { font-size: 0.9em; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div class="container">
    <div id="start-screen" style="text-align: center; padding: 40px 0;">
        <h1 style="border: none;">五十肩マニュアル<br>完全攻略マスター（上級編）</h1>
        <p style="font-size: 1.1em; margin-bottom: 30px;">全250問のプールから<br>ランダムに30問出題されます。</p>
        <p style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 40px;">合格ライン: 80%以上</p>
        <button class="next-btn active" onclick="startQuiz()">試験を開始する</button>
    </div>

    <div id="quiz-screen" style="display: none;">
        <button class="reset-btn" onclick="resetQuiz()">最初に戻る</button>
        <h1>五十肩クイズ</h1>
        <div class="status-bar">
            <span id="progress">問 1 / 30</span>
            <span id="score">正解数: 0</span>
        </div>
        <div id="question" class="question-box"></div>
        <div id="options"></div>
        <div id="feedback" class="feedback"></div>
        <button id="next-btn" class="next-btn" onclick="nextQuestion()">次の問題へ</button>
    </div>

    <div id="result-screen">
        <h2>試験終了</h2>
        <div class="score-circle">
            <span class="score-num" id="final-score">0</span>
            <span class="score-label">点 / 30点</span>
        </div>
        <p id="result-comment" style="font-size: 1.2em; margin: 20px 0;"></p>
        <button class="next-btn active" onclick="resetQuiz(true)">もう一度挑戦する</button>
    </div>
</div>

<script>
// --- 問題プール Part 1 (五十肩マニュアル上級 1-125問) ---
const poolPart1 = [
    // 概論・疫学・基礎
    {q:"五十肩（肩関節周囲炎）の定義について、最も適切な記述はどれか？",o:["発症から3ヶ月以上経過した慢性の肩痛","画像診断で明らかな腱板断裂が確認されるもの","ある期間を過ぎて肩の痛みが治癒する疾患であり、振り返って初めて診断される","原因不明の肩痛すべてを含む総称"],c:2,r:"「ある期間を過ぎて痛みが治癒する」ことが定義であり、他の疾患との鑑別がなされた上で、後方視的に診断されます。",s:"3ページ"},
    {q:"五十肩の合併症として、発生率が10〜20%と有意に高い基礎疾患は？",o:["高血圧","脂質異常症","糖尿病","甲状腺機能低下症"],c:2,r:"糖尿病患者は非糖尿病患者に比べて発生率がかなり高く、10〜20%が五十肩であるというデータがあります。",s:"2ページ"},
    {q:"五十肩の病期分類における「拘縮期」の特徴として正しいのは？",o:["安静時痛が強く、夜間痛で眠れない","炎症は軽減するが、組織の硬化により可動域制限が著明になる","可動域は正常化し、運動時痛のみが残る","炎症が再燃し、疼痛がピークに達する"],c:1,r:"炎症のピーク（疼痛期）を過ぎ、組織が瘢痕化・癒着して関節が固まる時期です。",s:"5ページ"},
    {q:"五十肩の病態機序として、臨床的に最も捉えやすい概念は？",o:["上腕二頭筋長頭腱の単独損傷","肩関節の前上方にある組織（腱板・滑液包・疎部）の損傷・癒着および第2肩関節の機能障害","肩甲下筋の短縮のみ","関節唇の断裂"],c:1,r:"前上方支持組織（腱板疎部や肩峰下滑液包など）の炎症と癒着が、痛みと拘縮の主座となることが多いです。",s:"8ページ"},
    {q:"疼痛期におけるリスク管理として、避けるべき治療手技は？",o:["肩甲胸郭関節の可動域訓練","愛護的なリラクセーション牽引","積極的な肩甲上腕関節の可動域拡大運動","アイシング"],c:2,r:"炎症期に患部（GH関節）をむやみに動かすと、炎症を再燃させたり、筋スパズムを悪化させるリスクがあります。",s:"5ページ"},
    
    // 解剖・バイオメカニクス
    {q:"第2肩関節を構成する組織に含まれないものは？",o:["肩峰下滑液包","烏口肩峰アーチ","腱板","関節唇"],c:3,r:"関節唇は第1肩関節（肩甲上腕関節）の構成要素です。第2肩関節は機能的な関節です。",s:"60ページ"},
    {q:"腱板疎部（Rotator Interval）を構成する筋腱の間隙は？",o:["棘上筋腱と棘下筋腱","棘下筋腱と小円筋腱","棘上筋腱と肩甲下筋腱","小円筋腱と大円筋腱"],c:2,r:"棘上筋腱（前縁）と肩甲下筋腱（上縁）の間の隙間を指し、ここが拘縮すると可動域が著しく制限されます。",s:"61ページ"},
    {q:"肩甲骨面上で約150°挙上し、上腕骨長軸と肩甲棘が一致する肢位を何というか？",o:["第1肢位","第3肢位","ゼロ・ポジション","安静位"],c:2,r:"筋の張力が均等になり、回旋ストレスが最も少ない安定した肢位です。",s:"65ページ"},
    {q:"肩関節外転運動における「凹凸の法則」に基づく関節包内運動（滑り）は？",o:["上腕骨頭が上方に転がり、上方に滑る","上腕骨頭が上方に転がり、下方に滑る","上腕骨頭が下方に転がり、上方に滑る","上腕骨頭が前方に滑る"],c:1,r:"骨頭（凸側）は骨運動（上方）と逆方向（下方）に滑ることで、インピンジメントを防ぎます。",s:"57ページ"},
    {q:"スムーズな関節運動のために必要な関節内圧の状態は？",o:["陽圧","大気圧","陰圧（吸着作用）","変動なし"],c:2,r:"正常な関節内は陰圧に保たれ、骨頭を関節窩に吸着・安定させています。炎症で陽圧化すると不安定になります。",s:"9ページ"},
    {q:"1st内旋可動域制限の主要な制限因子（筋肉）は？",o:["棘下筋上部線維","棘下筋下部線維","小円筋","大円筋"],c:0,r:"下垂位（1st）での内旋では、棘下筋の上部線維が最も伸張されます。",s:"63ページ"},
    {q:"2nd外旋（外転90°位での外旋）の主要な靭帯性制限因子は？",o:["上関節上腕靭帯 (SGHL)","中関節上腕靭帯 (MGHL)","前下関節上腕靭帯 (AIGHL)","烏口上腕靭帯 (CHL)"],c:2,r:"外転位での外旋では、関節包の前下方（AIGHL）が緊張し、骨頭の前方移動を制動します。",s:"63ページ"},
    {q:"肩甲上腕関節（GH）と肩甲胸郭関節（ST）の可動域比率（肩甲上腕リズム）は？",o:["1:1","2:1","3:1","4:1"],c:1,r:"全体として約2:1（GH:120°、ST:60°）の割合で動きます。",s:"72ページ"},

    // 評価・問診
    {q:"夜間痛の原因として、患側を下にして寝る（側臥位）ことで増悪するメカニズムは？",o:["肩関節が過伸展位になるから","肩関節が過内転位になり、上方支持組織が伸張されるから","血流が遮断されるから","神経が圧迫されるから"],c:1,r:"患側を下にして寝ると、肩関節は内転位を強制され、棘上筋や滑液包などの炎症部位に伸張ストレスがかかります。",s:"12ページ"},
    {q:"結帯動作（背中に手を回す）は、どのような運動の複合か？",o:["伸展・内転・内旋","屈曲・外転・外旋","伸展・外転・内旋","屈曲・内転・内旋"],c:0,r:"結帯動作は「伸展・内転・内旋」の複合運動であり、前方・上方組織の柔軟性が要求されます。",s:"66ページ"},
    {q:"対側肩に手を置く動作（水平内転テスト等）の制限因子となる運動方向は？",o:["屈曲・外転","伸展・内転","屈曲・内転・内旋","伸展・外旋"],c:2,r:"対側肩へのリーチは、屈曲・内転・内旋の複合運動です。",s:"66ページ"},
    {q:"三角筋前部線維の短縮を評価する際、肩関節をどのような肢位に誘導するか？",o:["下垂位で伸展","外転位で伸展","外転位で屈曲","屈曲位で内転"],c:1,r:"外転位で伸展させることで、前部線維を選択的に伸張・評価できます。",s:"80ページ"},
    {q:"前鋸筋下部線維の伸張テストにおける肩甲骨の操作方向は？",o:["上方回旋・外転","下方回旋・内転","挙上・外転","下制・内転"],c:1,r:"前鋸筋の作用（上方回旋・外転）と逆の動き（下方回旋・内転）で伸張性を評価します。",s:"124ページ"},

    // 治療・アプローチ
    {q:"疼痛期におけるリラクセーション牽引の正しい方向は？",o:["床に対して垂直方向","上腕骨の長軸方向","体幹に対して垂直方向","回旋方向"],c:1,r:"上腕骨の長軸に沿って優しく牽引することで、筋緊張を緩和し関節内圧を下げます。",s:"14ページ"},
    {q:"拘縮期における等尺性収縮（マッスルセッティング）の推奨強度は？",o:["100%（全力）","50%程度","10%〜20%（痛みが出ない範囲）","80%以上"],c:2,r:"強い収縮は痛みを誘発するため、10〜20%程度の弱い力から開始します。",s:"23ページ"},
    {q:"棘上筋前部線維を選択的に伸張（ストレッチ）させる肢位は？",o:["下垂位で内転","肩甲骨面上で内転・軽度外旋","最大外転","伸展・内旋"],c:1,r:"解剖学的走行を考慮すると、肩甲骨面上で内転させつつ、軽度外旋位にすることで効果的に伸張されます。",s:"45ページ"},
    {q:"後方関節包の伸張性を改善するために、骨頭を徒手的に動かす方向は？",o:["前方","後方","上方","下方"],c:1,r:"（注：関節包の伸張方向と骨頭の押し込み方向の関係）後方関節包を伸ばすには、骨頭を後方へ押し込む（グライディング）操作が有効です。",s:"48ページ"},
    {q:"腋窩陥凹（Axillary Pouch）の後方部を伸張する際の操作は？",o:["骨頭を上方へ引き上げる","骨頭を下方へ押し込みながら「内旋」させる","骨頭を下方へ押し込みながら「外旋」させる","圧迫のみ"],c:1,r:"下方への押し込みに加え、内旋を加えることで後方成分をより伸張できます。",s:"50ページ"},
    {q:"烏口上腕靭帯（CHL）の上方部線維を伸張させる操作は？",o:["下垂位での外旋","軽度外旋位から肩甲骨面上での内転","屈曲・内転","伸展・内旋"],c:1,r:"CHL上方部は棘上筋と連結しており、軽度外旋位からの内転操作で伸張されます。",s:"49ページ"},
    {q:"「12時の方向」への関節包内運動改善アプローチが指す方向は？",o:["前方","後方","上方（肩鎖関節方向）","下方（腋窩方向）"],c:2,r:"時計盤に見立てた場合、12時は上方（頭側）を指します。",s:"44ページ"},
    {q:"肩甲骨の過剰な挙上（シュラッグ）代償を抑制するために、アプローチすべき筋は？",o:["僧帽筋上部","肩甲挙筋","僧帽筋下部・前鋸筋","大菱形筋"],c:2,r:"僧帽筋下部や前鋸筋（下部）は肩甲骨の下制・上方回旋に働き、挙上代償を抑制するスタビライザーとして重要です。",s:"127ページ"},

    // 筋・神経・機能解剖
    {q:"三角筋後部線維の圧痛評価において、癒着を疑うべき隣接筋は？",o:["棘上筋","棘下筋","小円筋","大円筋"],c:1,r:"三角筋後部と棘下筋は重なり合っており、この間の癒着が後方部痛の原因になりやすいです。",s:"79ページ"},
    {q:"上腕二頭筋短頭の圧痛が好発する部位は？",o:["結節間溝","烏口突起の直上","烏口突起から遠位1~2横指","上腕骨中央"],c:2,r:"烏口突起の付着部そのものより、少し遠位の筋腱移行部付近で圧痛が出やすいです。",s:"141ページ"},
    {q:"小胸筋の短縮が引き起こす肩甲骨のアライメント異常は？",o:["後傾・上方回旋","前傾・下方回旋","挙上・外転","下制・内転"],c:1,r:"小胸筋は烏口突起に付着するため、短縮すると肩甲骨を前傾・下方回旋させます。",s:"135ページ"},
    {q:"四辺形間隙（QLS）を構成し、腋窩神経の絞扼に関与する筋は？",o:["棘上筋","小円筋","肩甲下筋","広背筋"],c:1,r:"小円筋、大円筋、上腕三頭筋長頭、上腕骨で構成されるQLSを腋窩神経が通過します。",s:"100ページ"},
    {q:"烏口腕筋を貫通し、絞扼されると前腕外側に痺れを出す神経は？",o:["正中神経","尺骨神経","橈骨神経","筋皮神経"],c:3,r:"筋皮神経は烏口腕筋を貫通して走行するため、同筋の硬結により絞扼されやすいです。",s:"145ページ"},
    {q:"広背筋が短縮した際に制限されやすい肩関節の可動域は？",o:["伸展","内旋","屈曲（挙上）","内転"],c:2,r:"広背筋は伸展・内旋・内転作用を持つため、短縮すると屈曲（挙上）を強く制限します。",s:"85ページ"},
    {q:"大円筋の作用として正しいものは？（第3肢位において）",o:["外旋で伸張、内旋で収縮","内旋で伸張、外旋で収縮","屈曲作用","作用しない"],c:0,r:"大円筋は内旋筋であるため、外旋位で伸張され、内旋時に収縮します。",s:"112ページ"},
    {q:"肩甲挙筋の作用で、挙上以外に重要な働きは？",o:["肩甲骨の上方回旋","肩甲骨の下方回旋","肩甲骨の外転","肩甲骨の後傾"],c:1,r:"肩甲挙筋は肩甲骨を挙上させつつ、下方回旋させる作用を持ちます。",s:"127ページ"},

    // その他・応用
    {q:"「痛みの認知行動療法」的アプローチとして、患者に伝えるべき適切なメッセージは？",o:["痛いときは絶対に動かさないでください","痛みは組織の損傷を意味するので、安静が第一です","痛みの範囲内であれば、動かしても壊れることはありません","痛みがなくなるまでリハビリは休みましょう"],c:2,r:"「動かしても大丈夫」という安心感を与え、過度な恐怖心（Fear-avoidance）を取り除くことが慢性痛改善の鍵です。",s:"263ページ"},
    {q:"五十肩患者における「腱板疎部」の安定化肢位は？",o:["下垂位内旋","下垂位外旋","屈曲位","内転位"],c:1,r:"下垂位で外旋すると、疎部（SGHLやCHL）が緊張し、骨頭が安定します。",s:"61ページ"},
    {q:"C-Cメカニズム（鎖骨と烏口突起の連動）において、肩甲骨上方回旋時に緊張する靭帯は？",o:["菱形靭帯","円錐靭帯","肩鎖靭帯","烏口肩峰靭帯"],c:1,r:"上方回旋に伴い、烏口鎖骨靭帯の後部にある円錐靭帯が緊張し、鎖骨を後方回旋させます。",s:"59ページ"},
    {q:"結帯動作の改善において、患側を上に引き上げる際に使用する手は？",o:["患側の手で頑張って上げる","健側の手でタオル等を使い引き上げる","セラピストが強く押し上げる","反動をつける"],c:1,r:"患側の筋力を使わず、健側の手でアシストすることで、過剰な筋緊張を防ぎながら可動域を広げます。",s:"55ページ"},
    {q:"更衣動作（上衣の着脱）をスムーズに行うために必要な可動域の目安は？",o:["屈曲90°","屈曲150°以上、結帯動作が可能","外転180°","伸展60°"],c:1,r:"袖を通すための結帯動作（伸展・内旋）と、頭を通すための屈曲・外旋（150°程度）の両方が必要です。",s:"42ページ"},
];
    // --- 問題プール Part 2 (五十肩マニュアル上級 126-250) ---
const poolPart2 = [
    // 筋・神経・機能解剖（続き）
    {q:"小胸筋の圧痛が強く、腕神経叢の絞扼（胸郭出口症候群）を疑うべき圧痛部位は？",o:["第3肋骨付近","烏口突起直上","烏口突起から遠位2~3横指","鎖骨下"],c:2,r:"烏口突起から遠位2~3横指の部分は、小胸筋の下を腕神経叢が通過する部位であり、圧痛が強い場合は絞扼を疑います。",s:"136ページ"},
    {q:"前鋸筋下部線維の短縮（伸張テスト陽性）が肩甲骨運動に及ぼす影響は？",o:["上方回旋制限","下方回旋制限","外転制限","挙上制限"],c:0,r:"前鋸筋下部線維は肩甲骨を上方回旋させる主要な筋ですが、短縮すると逆に正常な上方回旋の軌道を阻害することがあります（※マニュアルの文脈では伸張テストで下方回旋・内転させるため、短縮すると上方回旋・外転位で固まる可能性がありますが、機能不全としては上方回旋が出にくくなることが多いです）。",s:"124ページ"},
    {q:"上腕二頭筋長頭腱（LHB）の「プーリーシステム」に含まれない組織は？",o:["烏口上腕靭帯（CHL）","上関節上腕靭帯（SGHL）","棘上筋腱","小円筋腱"],c:3,r:"LHBを結節間溝に安定させるプーリー（滑車）システムは、CHL、SGHL、棘上筋腱、肩甲下筋腱などで構成されます。小円筋は関与しません。",s:"61ページ"},
    {q:"腋窩神経の絞扼障害を疑う際、筋力低下以外に評価すべき項目は？",o:["上腕二頭筋反射","肩外側（三角筋領域）の感覚障害","手背の感覚","握力"],c:1,r:"腋窩神経は三角筋の運動支配だけでなく、肩外側の皮膚感覚も支配しているため、知覚鈍麻の有無を確認します。",s:"230ページ"},
    {q:"肩甲骨の上方回旋に伴い、鎖骨の「後方回旋」を誘導する靭帯は？",o:["菱形靭帯","円錐靭帯","肩鎖靭帯","烏口肩峰靭帯"],c:1,r:"烏口鎖骨靭帯のうち、後方にある円錐靭帯が緊張することで、鎖骨を後方へ回転させます。",s:"59ページ"},
    {q:"肩甲下筋の触診において、指を侵入させる正しい方向と位置は？",o:["腋窩の後壁から肩甲骨後面へ","腋窩の深部から肩甲骨前面（肋骨面）へ","大胸筋の上から","鎖骨の下"],c:1,r:"肩甲下筋は肩甲骨の裏側（肋骨面）にあるため、腋窩から指を深く入れ、肩甲骨の前面に沿って触診します。",s:"77ページ"},
    {q:"烏口腕筋の触診において、筋皮神経を圧迫しないように注意すべき理由は？",o:["動脈を止めてしまうから","筋皮神経が烏口腕筋を貫通しており、圧迫で放散痛や痺れが出るから","筋断裂を起こすから","骨折させるから"],c:1,r:"筋皮神経は烏口腕筋を貫通して走行するため、強い圧迫は神経症状を誘発します。",s:"145ページ"},
    {q:"大胸筋鎖骨部と三角筋前部線維の境界にある「モーレンハイム窩」の臨床的意義は？",o:["特にない","橈側皮静脈が通り、触診のランドマークとなる","神経が通る","骨折しやすい"],c:1,r:"大胸筋と三角筋を分ける重要なランドマークであり、深層には小胸筋や血管神経束が存在します。",s:"73ページ"},

    // 治療・応用（続き）
    {q:"肩甲胸郭関節の可動域拡大訓練（モビライゼーション）を行う際の保持時間は？",o:["1秒","3秒","5秒","10秒"],c:2,r:"最終域で5秒程度保持することで、組織の伸張と学習効果を高めます。",s:"37ページ"},
    {q:"拘縮期における「3rd外旋エクササイズ」の正しい手順は？",o:["痛みを我慢して外旋する","外旋最終域から、内旋方向へ等尺性収縮を行う（ホールドリラックス）","反動をつけて外旋する","重りを持つ"],c:1,r:"可動域限界で拮抗筋（内旋筋）を収縮させ、その後の弛緩を利用して可動域を広げます。",s:"28ページ"},
    {q:"「振り子運動」の効果を高めるために追加すべき動作は？",o:["肘の屈伸","手首の背屈","前腕の回内・回外","指の屈伸"],c:2,r:"単なる前後運動だけでなく、回旋（回内外）を加えることで、関節包や腱板へのリラクセーション効果が高まります。",s:"19ページ"},
    {q:"結帯動作の改善において、患側の手を「健側の手」で引き上げる理由は？",o:["患側の筋力低下を補うため","患側の過剰な筋緊張（防御性収縮）を防ぎ、他動的に可動域を広げるため","健側のトレーニングになるから","左右差を確認するため"],c:1,r:"患側で頑張って上げようとするとアウターマッスルが緊張し、かえって動きが悪くなるため、健側主導で行います。",s:"55ページ"},
    {q:"内転エクササイズ（体の後ろで健側の手で引く）の際、注意すべき代償動作は？",o:["体幹の回旋（患側へ向く）","体幹の側屈","肘の屈曲","首の伸展"],c:0,r:"腕が引かれるのに合わせて体が回ってしまわないよう、体幹は正面を向いたまま行います。",s:"54ページ"},
    {q:"水平屈曲（Adduction）ストレッチの際、肩甲骨を固定する理由は？",o:["痛みを増やすため","肩甲骨が外転（前方に移動）してしまうと、後方組織（後方関節包・筋）が十分に伸張されないから","肩甲骨が内転するから","鎖骨を折らないため"],c:1,r:"肩甲骨が一緒に動いてしまうと、ターゲットであるGH関節後方組織へのストレッチ効果が逃げてしまいます。",s:"52ページ"},
    {q:"上方支持組織（棘上筋・滑液包）の伸張ストレスを減らすために、夜間就寝時に行うべき工夫は？",o:["枕を高くする","患側の下（肘〜手首）にタオルやクッションを入れ、肩の過伸展・過内転を防ぐ","うつ伏せで寝る","バンザイして寝る"],c:1,r:"肩がベッドに落ち込んで過伸展・内転位になるのを防ぐことで、安静時痛を緩和します。",s:"12ページ"},
    {q:"「腱板疎部」の癒着を剥離・伸張させるために有効なアプローチは？",o:["下垂位での外旋ストレッチ","下垂位での内旋ストレッチ","屈曲・内転","外転・内旋"],c:0,r:"腱板疎部（SGHL, CHL）は下垂位外旋で緊張するため、この肢位での持続伸張が有効です。",s:"61ページ"},

    // その他・総合
    {q:"五十肩患者への生活指導で「痛いから動かさない」ことの弊害（不動の悪循環）として正しいのは？",o:["炎症が早く治まる","組織の線維化・癒着が進行し、拘縮が悪化する","筋力が増える","骨が丈夫になる"],c:1,r:"必要以上の安静は、組織の癒着を強固にし、廃用性筋萎縮や血流低下を招き、治癒を遅らせます。",s:"3ページ"},
    {q:"糖尿病がある五十肩患者の予後について、あらかじめ説明しておくべきことは？",o:["すぐに治ります","通常よりも治癒に時間がかかり、重症化しやすい傾向があります","手術しか方法がありません","薬は効きません"],c:1,r:"高血糖による組織の糖化や血流障害により、炎症が長引きやすく、拘縮も強固になりやすいです。",s:"2ページ"},
    {q:"肩関節の「安定化機構」において、静的安定化機構に含まれるのは？",o:["腱板","上腕二頭筋長頭腱","関節唇・関節包・靭帯","三角筋"],c:2,r:"骨、軟骨、関節唇、関節包、靭帯などが静的な（動かない）安定化機構です。",s:"68ページ"},
    {q:"肩関節の「動的安定化機構」の主役となる筋群は？",o:["大胸筋・広背筋","三角筋","ローテーターカフ（回旋腱板）","僧帽筋"],c:2,r:"インナーマッスルである腱板が、骨頭を関節窩に引きつけ、動的な安定性を保ちます。",s:"68ページ"},
    {q:"「痛みの認知行動療法」的アプローチで、患者の破局的思考（Catastrophizing）を改善するための言葉かけは？",o:["痛いと組織が壊れます","もう治らないかもしれません","痛みがあっても動かして大丈夫です。動かすことで血流が良くなり治癒が促進されます","痛みがゼロになるまで待ちましょう"],c:2,r:"痛みに対する過剰な恐怖心を解き、適切な活動を促すことで、脳の疼痛抑制機能を回復させます。",s:"9ページ"},
    {q:"五十肩の回復期において、再発予防のために重要となる機能は？",o:["三角筋の筋力","肩甲骨と上腕骨の協調的な運動（肩甲上腕リズム）の獲得","関節の硬さ","痛みの無視"],c:1,r:"可動域が改善しても、使い方が悪い（代償動作が残っている）と再発しやすいため、モーターコントロールの再教育が重要です。",s:"127ページ"}
];

// --- 2つのプールを結合して使用する ---
const questionPool = poolPart1.concat(poolPart2);

// --- システムロジック ---
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

let currentQuizSet = [];
let currentQuestionIndex = 0;
let score = 0;

const startScreen = document.getElementById('start-screen');
const quizScreen = document.getElementById('quiz-screen');
const resultScreen = document.getElementById('result-screen');
const questionBox = document.getElementById('question');
const optionsBox = document.getElementById('options');
const feedbackBox = document.getElementById('feedback');
const nextBtn = document.getElementById('next-btn');
const progress = document.getElementById('progress');
const scoreDisplay = document.getElementById('score');

function startQuiz() {
    currentQuizSet = shuffle([...questionPool]).slice(0, 30);
    currentQuestionIndex = 0;
    score = 0;
    startScreen.style.display = 'none';
    resultScreen.style.display = 'none';
    quizScreen.style.display = 'block';
    showQuestion();
}

function resetQuiz(restart = false) {
    if (restart || confirm("テストを中断して最初の画面に戻りますか？")) {
        startScreen.style.display = 'block';
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        currentQuestionIndex = 0;
        score = 0;
    }
}

function showQuestion() {
    const q = currentQuizSet[currentQuestionIndex];
    questionBox.textContent = `Q${currentQuestionIndex + 1}. ${q.q}`;
    optionsBox.innerHTML = '';
    feedbackBox.style.display = 'none';
    feedbackBox.className = 'feedback';
    nextBtn.classList.remove('active');
    progress.textContent = `問 ${currentQuestionIndex + 1} / 30`;
    scoreDisplay.textContent = `正解数: ${score}`;

    q.o.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(index, btn, q);
        optionsBox.appendChild(btn);
    });
}

function checkAnswer(selectedIndex, selectedBtn, q) {
    if (nextBtn.classList.contains('active')) return;

    const isCorrect = (selectedIndex === q.c);
    const options = document.querySelectorAll('.option-btn');

    if (isCorrect) {
        selectedBtn.classList.add('correct');
        feedbackBox.innerHTML = `<strong>正解！</strong><br>${q.r}<span class="source-ref">参照：${q.s}</span>`;
        feedbackBox.className = 'feedback';
        score++;
        scoreDisplay.textContent = `正解数: ${score}`;
    } else {
        selectedBtn.classList.add('incorrect');
        options[q.c].classList.add('correct');
        feedbackBox.innerHTML = `<strong>不正解...</strong><br>正解は「${q.o[q.c]}」です。<br>${q.r}<span class="source-ref">参照：${q.s}</span>`;
        feedbackBox.className = 'feedback error';
    }
    feedbackBox.style.display = 'block';
    nextBtn.classList.add('active');
}

function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < 30) {
        showQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    quizScreen.style.display = 'none';
    resultScreen.style.display = 'block';
    document.getElementById('final-score').textContent = score;
    
    const percentage = (score / 30) * 100;
    let comment = "";
    if (percentage === 100) comment = "完璧です！マニュアルを完全にマスターしています。";
    else if (percentage >= 80) comment = "素晴らしい成績です！臨床で十分通用する知識です。";
    else if (percentage >= 60) comment = "合格ラインです。間違えた箇所を復習しましょう。";
    else comment = "もう少し復習が必要です。マニュアルを読み返して再挑戦しましょう。";
    
    const commentEl = document.getElementById('result-comment');
    if(commentEl) {
        commentEl.textContent = comment;
        commentEl.style.color = percentage >= 80 ? "#27ae60" : "#e74c3c";
    }
}
</script>
</body>
</html>
